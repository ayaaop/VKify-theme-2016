{extends "@layout.xml"}

{block title}
    {_edit} {$user->getCanonicalName()}
{/block}

{block heading}
    {$user->getCanonicalName()}
{/block}

{block afterHeader}
    {var $tabs = [
        [
            'url' => '#',
            'title' => 'main',
            'active' => true,
            'attrs' => ['data-tab' => 'main']
        ],
        [
            'url' => '#',
            'title' => 'c_groups',
            'active' => false,
            'attrs' => ['data-tab' => 'groups']
        ]
    ]}

    {include "../components/page_tabs_header.xml", tabs => $tabs, white => true}
{/block}

{block content}
    <div id="tab-main" class="admin-tab-content">
        <form method="POST">
            <div class="settings_panel clear_fix group_settings">
                <div class="settings_list_row">
                    <div class="settings_label">{_avatar}</div>
                    <div class="settings_labeled_text">
                        <div class="avatar_block">
                            <div class="avatar_block_inner">
                                <img id="bigAvatar" src="{$user->getAvatarUrl('tiny')}"></img>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="settings_list_row">
                    <div class="settings_label">ID</div>
                    <div class="settings_labeled_text" dir="auto">{$user->getId()}</div>
                </div>
                <div class="settings_list_row">
                    <div class="settings_label">UUID</div>
                    <div class="settings_labeled_text" dir="auto">{$user->getChandlerUser()->getId()}</div>
                </div>
                <div class="settings_list_row">
                    <div class="settings_label">{_admin_first_known_ip}</div>
                    <div class="settings_labeled_text" dir="auto">{$user->getRegistrationIP()}</div>
                </div>
                <div class="settings_list_row">
                    <div class="settings_label">{_name}</div>
                    <div class="settings_labeled_text">
                        <input type="text" name="first_name" value="{$user->getFirstName()}" />
                    </div>
                </div>
                <div class="settings_list_row">
                    <div class="settings_label">{_surname}</div>
                    <div class="settings_labeled_text">
                        <input type="text" name="last_name" value="{$user->getLastName()}" />
                    </div>
                </div>
                <div class="settings_list_row">
                    <div class="settings_label">{_nickname}</div>
                    <div class="settings_labeled_text">
                        <input type="text" name="nickname" value="{$user->getPseudo()}" />
                    </div>
                </div>
                <div class="settings_list_row">
                    <div class="settings_label">{_status}</div>
                    <div class="settings_labeled_text">
                        <input type="text" name="status" value="{$user->getStatus()}" />
                    </div>
                </div>
                <div class="settings_list_row">
                    <div class="settings_label">E-Mail</div>
                    <div class="settings_labeled_text">
                        <input type="email" name="email" value="{$user->getEmail()}" />
                    </div>
                </div>
                <div class="settings_list_row">
                    <div class="settings_label">{_admin_shortcode}</div>
                    <div class="settings_labeled_text">
                        <input type="text" name="shortcode" value="{$user->getShortCode()}" />
                    </div>
                </div>
                <div class="settings_line"></div>
                <div class="settings_list_row">
                    <div class="settings_label">{_admin_settings}</div>
                    <div class="settings_labeled_text">
                        <label><input class="toggle-large" type="checkbox" name="verify" value="1" n:attr="checked => $user->isVerified()" /> {_admin_verification}</label>
                        <label><input class="toggle-large" type="checkbox" name="hide_global_feed" value="1" n:attr="checked => $user->isHideFromGlobalFeedEnabled()" /> {_admin_hide_global_feed}</label>
                    </div>
                </div>
                <div class="settings_list_row">
                    <div class="settings_label">{_admin_user_online}</div>
                    <div class="settings_labeled_text">
                        <select name="online" class="select">
                            <option value="0" n:attr="selected => $user->onlineStatus() == 0">{_admin_user_online_default}</option>
                            <option value="1" n:attr="selected => $user->onlineStatus() == 1">{_admin_user_online_incognite}</option>
                            <option value="2" n:attr="selected => $user->onlineStatus() == 2">{_admin_user_online_deceased}</option>
                        </select>
                    </div>
                </div>
                <div class="settings_line"></div>
                <div class="settings_list_row">
                    <div class="settings_label">{_new_password}</div>
                    <div class="settings_labeled_text">
                        <input type="password" name="password" value="" />
                    </div>
                </div>
                <div class="settings_list_row">
                    <div class="settings_label"></div>
                    <div class="settings_labeled_text">
                        <a class="button" onclick="let pswd = Math.random().toString(27).slice(2,12); alert('Сгенерированный пароль: ' + pswd + '\n\nНе забудьте сообщить пользователю, чтобы он сменил пароль на свой!'); $('input[name=password]').val(pswd);">{_generate_password}</a>
                    </div>
                </div>
                <div class="settings_list_row">
                    <div class="settings_label"></div>
                    <div class="settings_labeled_text">
                        <input type="hidden" name="hash" value="{$csrfToken}" />
                        <input type="submit" value="{_save}" class="button" />
                    </div>
                </div>
            </div>
        </form>
    </div>
    <div id="tab-groups" class="admin-tab-content" style="display: none;">
        <form method="POST">
            <div class="settings_panel clear_fix">
                <div class="settings_list_row">
                    <div class="settings_label">{_c_add_to_group}</div>
                    <div class="settings_labeled_text">
                        <select name="add-to-group" class="select">
                            <option n:foreach="$c_groups_list as $group" value="{$group->id}">
                                {$group->name}
                            </option>
                        </select>
                    </div>
                </div>
                <div class="settings_list_row">
                    <div class="settings_label"></div>
                    <div class="settings_labeled_text">
                        <input type="hidden" name="hash" value="{$csrfToken}" />
                        <input type="submit" value="{_c_add_to_group}" class="button" />
                    </div>
                </div>
            </div>
            <br/>
            <div class="page_block_sub_header">{_current_groups}</div>
            <div class="settings_panel clear_fix">
                <div class="page_table_wrapper">
                    <table class="page_table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>{_admin_actions}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr n:foreach="$c_memberships as $membership">
                                <td>
                                    <a href="/admin/chandler/groups/{$membership->group}?act=members">{$membership->group}</a>
                                </td>
                                <td>
                                    <a
                                        class="button button_gray"
                                        href="/admin/chandler/groups/{$membership->group}?act=removeMember&uid={$user->getChandlerGUID()}"
                                    >
                                        {_c_remove_from_group}
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </form>
    </div>
{/block}
