{extends "../@layout.xml"}
{block title}{_menu_help}{/block}

{block header}
    {_menu_help}
{/block}

{block content}
    {var $isMain = $mode === 'faq'}
    {var $isNew  = $mode === 'new'}
    {var $isList = $mode === 'list'}

    {if $thisUser}
        {include "../components/page_tabs_header.xml", tabs => [
            [
                'url' => '/support',
                'title' => 'support_faq',
                'active' => $isMain,
                'id' => 'support_tab_faq'
            ],
            [
                'url' => '/support?act=list',
                'title' => 'support_list',
                'active' => $isList,
                'id' => 'support_tab_list'
            ],
            [
                'url' => '/support?act=new',
                'title' => 'support_new',
                'active' => $isNew,
                'id' => 'support_tab_new'
            ]
        ], white => true}
            {if $isNew}
                <div class="page_block page_padding">
                    {if !is_null($banReason)}
                        <center>
                            <img src="/assets/packages/static/openvk/img/oof.apng" alt="{_banned_alt}" style="width: 20%;" />
                        </center>
                        <p>
                            {tr("banned_in_support_1", htmlentities($thisUser->getCanonicalName()))|noescape}<br/>
                            {tr("banned_in_support_2", htmlentities($banReason))|noescape}
                        </p>
                    {else}
                        <div class="new">
                            <form action="/support" method="post" style="margin:0;">
                                <div class="form_group tickets_create_form">
                                    <div class="form_field">
                                        <div class="form_data">
                                            <input type="text" name="name" style="resize: vertical;" placeholder="{_support_new_title}" />
                                        </div>
                                    </div>
                                    <div class="form_field">
                                        <div class="form_data">
                                            <textarea name="text" style="resize: vertical;" placeholder="{_support_new_content}"></textarea>
                                        </div>
                                    </div>
                                    <div class="form_field">
                                        <div class="form_data">
                                            <input type="hidden" name="hash" value="{$csrfToken}" />
                                            <input type="submit" value="{_write}" class="button fl_r" />
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    {/if}
                </div>
            {/if}
    {/if}
    <div n:ifcontent n:class="page_block, $isList ? 'list_view tickets_list' : page_padding">
    {if $isMain}
        <div n:foreach="$faq as $section" class="faq">
            <div id="faqhead">{$section[0]}</div>
            <div id="faqcontent">{$section[1]|noescape}</div>
        </div>
    {/if}

    {if $isList}
        {foreach $tickets as $ticket}
            <div class="search_row type{$ticket->getType()}">
                <div class="info fl_l">
                    <div class="labeled name">
                        <a href="/support/view/{$ticket->getId()}">
                            <b>
                                {$ticket->getName()}
                            </b>
                        </a>
                    </div>
                    <div class="labeled">
                        {$ticket->getStatus()}
                    </div>
                </div>
            </div>
        {/foreach}

        {if $count < 1}
            {include "../components/nothing.xml"}
        {/if}

            {include "../components/paginator.xml", conf => (object) [
                "page"     => $page,
                "count"    => $count,
                "amount"   => sizeof($tickets),
                "perPage"  => OPENVK_DEFAULT_PER_PAGE,
                "atBottom" => true,
                "tidy"     => true
            ]}
    {/if}
    </div>
{/block}
